@page "/"
@using CarrierIntegrationWebApp.Services
@rendermode InteractiveServer
@inject HttpClient Http
@inject BearerTokenService BearerTokenService

<PageTitle>Home</PageTitle>

<h1>Hello, SpeedShip!</h1>

Welcome to your carrier integration app.

@code {
    private static bool hasInvalidated = false;

    protected override async Task OnInitializedAsync()
    {
        if (!hasInvalidated)
        {
            try
            {
                var token = BearerTokenService.Token;
                
                if (!string.IsNullOrEmpty(token))
                {
                    // Invalidate the token on the server by calling logout
                    try
                    {
                        await Http.PostAsJsonAsync("https://localhost:7082/logout", new { token = token });
                    }
                    catch { }
                    
                    // Remove from service
                    BearerTokenService.RemoveToken();
                }
                
                hasInvalidated = true;
            }
            catch { }
        }
    }
}
